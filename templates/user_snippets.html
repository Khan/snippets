{%- set title='Snippets for ' + username -%}
{% include "header.html" %}

<h1>Snippets for {{username}}</h1>

{% for snippet in snippets %}
  <div class="snippet">
  {% if editable %}
    <form action="/update_snippet" method="get">

    <h2>Snippets for the week starting {{snippet.week|readable_date}}
        &nbsp; <input type="submit" value="Save" class="save-button">
        &nbsp; <button class="undo-button">undo</button>
        {% if snippet.text == null_snippet_text and snippet.week == one_week_ago %}
        <span class="snippet-alert">Due today!</span>
        {% endif %}
        {% if snippet.text == null_snippet_text and snippet.week == eight_days_ago %}
        <span class="snippet-alert">OVERDUE!</spanf>
        {% endif %}
    </h2>

    <input type="hidden" name="week" value="{{snippet.week|iso_date}}">
    <input type="hidden" name="u" value="{{username}}">
    {% if snippet.text == null_snippet_text and user.category == null_category %}
    <div>
      <span class="snippet-alert">
        WARNING: Snippet will go in the "{{null_category}}" category.
      </span>
      <a href="/settings?msg=Set+'Category'+below,+then+click+'Save.'&redirect_to=snippet_entry"
         >Set your snippet category!</a>
    </div>
    {% endif %}
    <div class="snippet-setting">
    <label>
    <input type="checkbox" name="private" value="True"
           {% if snippet.private %}checked{% endif %}>
    Make snippet private (only viewable by people in the domain <i>{{domain}}</i>)
    </label>
    </div>
    <div class="snippet-setting">
    <label>
    <input type="checkbox" name="is_markdown" value="True"
           {% if snippet.is_markdown %}checked{% endif %}>
    Snippet is written in <a href="http://daringfireball.net/projects/markdown/syntax">markdown syntax</a>
    </label>
    </div>
    <textarea name="snippet" rows="6" cols="80">{{snippet.text}}</textarea>
    <div class="markdown_preview" style="display:none">
      <i>Preview:</i>
      <blockquote>
        <div class="markdown_snippet"></div>
      </blockquote>
    </div>
    </form>
  {% else %}
    <h2>Snippets for the week starting {{snippet.week|readable_date}}</h2>

    {% if snippet.is_markdown %}
    <div class="markdown_snippet
                {% if snippet.private %}private_snippet{% endif %}"
         >{{snippet.text|safe}}</div>
    {% else %}
    <div class="text_snippet
                {% if snippet.private %}private_snippet{% endif %}"
         >{{snippet.text|urlize}}</div>
    {% endif %}
  {% endif %}
  </div>
{% endfor %}

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
<script src="static/snippets.js"></script>
<script>
      marked.setOptions({sanitize: true});
      $(".markdown_snippet").each(function(i, v) {
         v.innerHTML = marked(v.innerHTML);
      });
</script>

{% include "footer.html" %}
